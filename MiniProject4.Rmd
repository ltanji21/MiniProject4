---
title: "MiniProject 4"
author: "Leigh Tanji, Samantha Bryce"
date: "2017年11月29日"
output: html_document
---

Loading libraries 
```{r}
suppressMessages(library(mdsr))
suppressMessages(library(RMySQL))
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
```

Getting information on directors. 
```{r, message=FALSE, echo=FALSE}
all_directors <- dbConnect_scidb(dbname = "imdb")
class(all_directors)

all_directors <- all_directors %>%
  dbGetQuery("SELECT person_id, movie_id, role_id
             FROM cast_info 
             WHERE role_id = 8;")
```

Filing in Movie titles in `directors` table. 
```{r}
movies <- dbConnect_scidb(dbname = "imdb")
class(movies)


movies <- movies %>%
  dbGetQuery("SELECT id, title, kind_id, production_year
             FROM title
             WHERE kind_id = 1;")


list2env(movies, envir = .GlobalEnv)
movies <- rename(movies, movie_id = id)


movie_directors <- all_directors %>%
  inner_join(movies, by = "movie_id")
```

Combining information about the directors to the 'movie_directors' table. 
```{r}
director_info <- dbConnect_scidb(dbname = "imdb")
class(director_info)


director_info<- director_info %>%
  dbGetQuery("SELECT id, name, gender 
             FROM imdb.name;")

list2env(director_info, envir = .GlobalEnv)

director_info<- rename(director_info, person_id = id)

all_directors_info <- movie_directors %>%
  inner_join(director_info, by = "person_id")
```

Get number of directors per year. 
```{r}
director_no <- all_directors_info %>%
  group_by(production_year) %>%
  filter(is.na(gender) & production_year >= 1896 & production_year <= 2017) %>%
  summarize(no_directors = n())
```

Joining the number of firectors total table to number of female directors table. 
```{r}
female_director_no <- all_directors_info %>%
  group_by(production_year) %>%
  filter(gender == "f" & production_year >= 1896 & production_year <= 2017) %>%
  summarize(female_director = n())
```

Getting the percentage of female directors by year. 
```{r}
female_director_ratio <- female_director_no %>%
  inner_join(director_no, by = "production_year") %>%
   group_by(production_year) %>%
  summarise(ratio_f_directors = (female_director/no_directors)*100)
  
```

Making a ggplot of ratio of females per year.
```{r, message=FALSE, error= FALSE, echo=FALSE}
female_director_graph <- ggplot(female_director_ratio, aes(x = production_year, y = ratio_f_directors)) + 
  geom_point(alpha = .3) +
  ylab("percentage of female directors") + 
  xlab("Production Year") + 
  ggtitle("percentage of films produced by women per year") +
  geom_line()
  
female_director_graph
```






















