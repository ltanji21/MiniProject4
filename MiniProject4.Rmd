---
title: "MiniProject 4"
author: "Leigh Tanji, Samantha Bryce"
date: "2017年11月29日"
output: html_document
---

#Loading libraries
```{r}
suppressMessages(library(mdsr))
suppressMessages(library(RMySQL))
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
```

Getting just directors 
```{r, message=FALSE, echo=FALSE}
all_directors <- dbConnect_scidb(dbname = "imdb")
class(all_directors)

all_directors <- all_directors %>%
  dbGetQuery("SELECT person_id, movie_id, role_id
             FROM cast_info 
             WHERE role_id = 8;")
```

Filing in Movie titles in `directors` table
```{r}
movies <- dbConnect_scidb(dbname = "imdb")
class(movies)


movies <- movies %>%
  dbGetQuery("SELECT id, title, kind_id, production_year
             FROM title
             WHERE kind_id = 1;")


list2env(movies, envir = .GlobalEnv)
movies <- rename(movies, movie_id = id)


movie_directors <- all_directors %>%
  inner_join(movies, by = "movie_id")
```

Combining information about the directors to the 'movie_directors' table. 
```{r}
director_info <- dbConnect_scidb(dbname = "imdb")
class(director_info)


director_info<- director_info %>%
  dbGetQuery("SELECT id, name, gender 
             FROM imdb.name;")

list2env(director_info, envir = .GlobalEnv)

director_info<- rename(director_info, person_id = id)

all_directors_info <- movie_directors %>%
  inner_join(director_info, by = "person_id")
```

Clean Up the table of female directors and look at their number of movie productions per year.
```{r}
female_director_no <- all_directors_info %>%
  group_by(production_year) %>%
  filter(gender == "f" & production_year >= 1896 & production_year <= 2017) %>%
  summarize(female_director = n())
```

Looking at male directors  for comparison
```{r}
male_director_no <- all_directors_info %>%
  group_by(production_year) %>%
  filter(gender == "m" & production_year >= 1896 & production_year <= 2017) %>%
  summarize(male_director = n())
```


Making a ggplot of films produced by females per year.
```{r, message=FALSE, error= FALSE, echo=FALSE}
female_directors_year <- ggplot(female_director_no, aes(x = production_year, y = female_director)) + geom_point(alpha = .3) +
  ylab("Number of films directed") + 
  xlab("Production Year") + 
  ggtitle("Number of films produced by women per year") +
  geom_line() +
  geom_point(colour = "red", aes(x = 2016, y = 5688)) +
  annotate("text", x = 1950, y = 5688, label = "2016 had most films (5688) directed by women", colour = "red", size = 2.5)

female_directors_year
```

Doing the same thing for Males, ggplot of gilms produced by males per year.
```{r}
male_directors_year <- ggplot(male_director_no, aes(x = production_year, y = male_director)) + geom_point(alpha = .3) +
  ylab("Number of films directed") + 
  xlab("Production Year") + 
  ggtitle("Number of films produced by men per year") +
  geom_line()

male_directors_year
```

Looking at number of films produced by each film director. 
```{r}
no_films_director <- female_directors %>%
  group_by(name) %>%
  filter(production_year >= 1896 & production_year <= 2017) %>%
  summarize(film_no = n()) %>%
  arrange(desc(film_no))
```

















